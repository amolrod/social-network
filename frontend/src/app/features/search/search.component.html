<div class="search-container">
  <div class="search-header">
    <div class="search-input-wrapper">
      <svg class="search-icon-left" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
      </svg>
      <input 
        type="text" 
        class="search-input"
        placeholder="Buscar usuarios..."
        [value]="searchQuery()"
        (input)="onSearchInput($event)"
        autofocus>
      @if (searchQuery().length > 0) {
        <button class="clear-button" (click)="searchQuery.set(''); searchResults.set([]); noResults.set(false)" type="button">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      }
    </div>

    <!-- Tabs -->
    <div class="tabs">
      <button 
        class="tab" 
        [class.active]="activeTab() === 'users'"
        (click)="changeTab('users')"
        type="button">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
          <circle cx="9" cy="7" r="4"></circle>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
          <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
        </svg>
        <span>Usuarios</span>
      </button>
      <button 
        class="tab" 
        [class.active]="activeTab() === 'trending'"
        (click)="changeTab('trending')"
        type="button">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
        </svg>
        <span>Tendencias</span>
      </button>
    </div>
  </div>

  @if (isSearching()) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Buscando...</p>
    </div>
  }

  @if (noResults() && !isSearching()) {
    <div class="empty-state">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      <h3>No se encontraron usuarios</h3>
      <p>Intenta con otro término de búsqueda</p>
    </div>
  }

  @if (searchResults().length > 0) {
    <div class="users-section">
      <h2>Resultados ({{ searchResults().length }})</h2>
      <div class="users-grid">
        @for (user of searchResults(); track user.id) {
          <div class="user-card" (click)="goToProfile(user.username)">
            <div class="user-avatar">
              @if (user.avatarUrl) {
                <img [src]="user.avatarUrl" [alt]="user.fullName || user.username">
              } @else {
                <div class="avatar-placeholder">
                  {{ (user.fullName || user.username).charAt(0).toUpperCase() }}
                </div>
              }
            </div>
            <div class="user-info">
              <div class="user-name-row">
                <span class="full-name">{{ user.fullName }}</span>
                @if (user.isVerified) {
                  <svg class="verified-badge" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                  </svg>
                }
              </div>
              <span class="username">@{{ user.username }}</span>
              @if (user.bio) {
                <p class="bio">{{ user.bio }}</p>
              }
              <div class="user-stats">
                <span><strong>{{ user.followersCount || 0 }}</strong> seguidores</span>
                <span><strong>{{ user.followingCount || 0 }}</strong> siguiendo</span>
              </div>
            </div>
            @if (!isCurrentUser(user.id)) {
              <div class="follow-action" (click)="$event.stopPropagation()">
                <app-follow-button
                  [userId]="user.id"
                  [isFollowing]="isFollowing(user.id)"
                  [size]="'small'"
                  (followChange)="onFollowChange(user.id, $event)">
                </app-follow-button>
              </div>
            }
          </div>
        }
      </div>
    </div>
  }

  @if (suggestedUsers().length > 0 && searchQuery().length === 0 && activeTab() === 'users') {
    <div class="users-section">
      <h2>Usuarios Sugeridos</h2>
      <div class="users-grid">
        @for (user of suggestedUsers(); track user.id) {
          <div class="user-card" (click)="goToProfile(user.username)">
            <div class="user-avatar">
              @if (user.avatarUrl) {
                <img [src]="user.avatarUrl" [alt]="user.fullName || user.username">
              } @else {
                <div class="avatar-placeholder">
                  {{ (user.fullName || user.username).charAt(0).toUpperCase() }}
                </div>
              }
            </div>
            <div class="user-info">
              <div class="user-name-row">
                <span class="full-name">{{ user.fullName }}</span>
                @if (user.isVerified) {
                  <svg class="verified-badge" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                  </svg>
                }
              </div>
              <span class="username">@{{ user.username }}</span>
              <div class="user-stats">
                <span><strong>{{ user.followersCount || 0 }}</strong> seguidores</span>
                <span><strong>{{ user.followingCount || 0 }}</strong> siguiendo</span>
              </div>
            </div>
            @if (!isCurrentUser(user.id)) {
              <div class="follow-action" (click)="$event.stopPropagation()">
                <app-follow-button
                  [userId]="user.id"
                  [isFollowing]="isFollowing(user.id)"
                  [size]="'small'"
                  (followChange)="onFollowChange(user.id, $event)">
                </app-follow-button>
              </div>
            }
          </div>
        }
      </div>
    </div>
  }

  <!-- Trending Topics -->
  @if (activeTab() === 'trending' || (showTrending() && searchQuery().length === 0)) {
    <div class="trending-section">
      <div class="trending-header">
        <h2>Tendencias</h2>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
          <polyline points="17 6 23 6 23 12"></polyline>
        </svg>
      </div>
      <div class="trending-list">
        @for (topic of trendingTopics(); track topic.id) {
          <div class="trending-item" (click)="searchTrending(topic.hashtag)">
            <div class="trending-info">
              <span class="trending-category">{{ topic.category }}</span>
              <h3 class="trending-hashtag">{{ topic.hashtag }}</h3>
              <span class="trending-count">{{ formatTrendCount(topic.count) }} publicaciones</span>
            </div>
            <svg class="trending-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
            </svg>
          </div>
        }
      </div>
    </div>
  }
</div>
